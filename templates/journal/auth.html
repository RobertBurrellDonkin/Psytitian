<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
    "http://www.w3.org/TR/html4/strict.dtd">
<html>
<!--     
   Copyright [2010] Robert Burrell Donkin http://robertburrelldonkin.name
   
    This file is part of Psytitian.
  
    Psytitian is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.
  
    Psytitian is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.
  
    You should have received a copy of the GNU General Public License
    along with Psytitian.  If not, see <http://www.gnu.org/licenses/>.
-->
    <head>
        <title>Journal</title>    

    <style type="text/css">
        @import "<%= app_root %>dijit/themes/tundra/tundra.css";
        @import "<%= app_root %>dojo/resources/dojo.css";
        @import "<%= app_root %>psytitian/resources/psytitian.css";
        @import "<%= app_root %>style/main.css";
    </style>
    
    <!-- Dojo-->
    <script type="text/javascript" src="<%= app_root %>dojo/dojo.js"
        djConfig="parseOnLoad:true, isDebug:true"></script>
    
    <!-- Application -->
    <script type='text/javascript' src='js/cite.js'></script>
    <script type='text/javascript' src='js/config.js'></script>
    
    <script type="text/javascript"> 
        dojo.require("dojo.parser");
        dojo.require("dijit.form.Form");
        dojo.require("dijit.form.TextBox");


        function loginSubmit(e) {
            e.preventDefault();
            dojo.byId("loginFormError").innerHTML = "";
            var statusNode = dojo.byId("loginFormStatus");
            statusNode.innerHTML = "Please wait...";
            var loginJson = dojo.formToJson("loginForm");
            console.log(loginJson);
            dojo.xhrPost({
                url: "/_session",
                handleAs: "json",
                handle: function(response, ioArgs) {
            	   console.log("LOAD RETURNED");
            	   console.log(json);
                    statusNode.innerHTML = "Success";
                },
                error: function(response, ioArgs) {
                    console.log("ERROR RETURNED");
                	console.log(response);
                	statusNode.innerHTML = "";
                    var errorNode = dojo.byId("loginFormError");
                    if (response.responseText && response.responseText.reason) {
                        errorNode.innerHTML = error.responseText.reason;
                    } else {
                        errorNode.innerHTML = "Login failed";
                    }
                }
            });
        }

        dojo.addOnLoad(function(){
            var nameForm = dojo.byId("loginForm");   
            dojo.connect(nameForm,"submit","loginSubmit");    
        });
    </script>
    
    </head>
    <body class="tundra">
    <h1>Journal</h1>
    <p>Add <a href="<%= app_root %>_show/journal/">new</a> or search <a href="<%= app_root %>papers.html">papers</a></p>
<p>
Login
</p>
<form id='login' action="/_session" method='post'>
    <p><label>User</label><input type='text' name='username'/></p>
    <p><label>Password</label><input type='password' name='password'/></p>
    <p><input type='submit'/></p>
</form>
        <form dojoType="dijit.form.Form" id='loginForm'>
            <label for='username' id='usernameLabel'>User Name</label>
            <input type="text" name="username" id='username' dojoType="dijit.form.TextBox" 
                    required="true"/>
            <label for='password' id='passwordLabel'>Password</label>
            <input type="password" name="password" id='password' required="true"/>
            <button class='go' type='submit'>Login</button>
            <span class='error' id='loginFormError'></span>
            <span id='loginFormStatus'></span>
        </form>
</body>
</html>